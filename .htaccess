# Enable rewrite engine
RewriteEngine On

# Exclude /api/ requests from being rewritten
RewriteRule ^api/ - [L]

# Route /new/ requests to the new site (don't rewrite)
RewriteRule ^new/ - [L]

# Redirect /bg/ and /en/ to /new/bg/ and /new/en/
RewriteRule ^bg/(.*)$ /new/bg/$1 [R=301,L]
RewriteRule ^en/(.*)$ /new/en/$1 [R=301,L]
RewriteRule ^bg/?$ /new/bg/ [R=301,L]
RewriteRule ^en/?$ /new/en/ [R=301,L]

# Route root requests to old site
RewriteRule ^$ /sof-car.eu/ [L]
RewriteRule ^(?!new/|api/|sof-car\.eu/)(.*)$ /sof-car.eu/$1 [L]

# Security headers
Header always set X-Frame-Options DENY
Header always set X-Content-Type-Options nosniff
Header always set X-XSS-Protection "1; mode=block"

# Cache static assets
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
</FilesMatch>